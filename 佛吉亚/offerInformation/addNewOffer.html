<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>全局自定义模板</title>
</head>
<body>
<!--css配置-->
<style>
</style>
<!--是否加载全局模板 请填写正确的load-template 格式：http://www.xxx.com/-->
<section id="rootTemplate" load-template=""></section>
<!--配置API地址 可以覆盖root配置 api-url格式：http://www.xxx.com/-->
<section id="controller" api-url=""></section>
<!--RootToolbar配置-->
<section id="toolbar">
</section>
<!--Template配置 key是唯一标识，请不要修改已保证页面正常运行-->
<section type="template" id="template">
<a-row>
    <a-col>
        <a-title key="2031560318618965" data-name="offer信息"></a-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-create-by key="creater" data-name="创建人"></a-create-by>
    </a-col>
    <a-col>
        <a-created-time key="createdTime" data-name="创建时间"></a-created-time>
    </a-col>
    <a-col>
        <a-sequence-no key="sequenceNo" data-name="单据号"></a-sequence-no>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-dropdown key="offerType" data-name="offer类别" data-options="中智offer;佛吉亚offer;佛吉亚转入高管offer"></a-dropdown>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-date key="distributeOfferDate" data-name="offer发放日期"></a-date>
    </a-col>
    <a-col>
        <a-text key="realName" data-name="姓名"></a-text>
    </a-col>
    <a-col>
        <a-dropdown key="sex" data-name="性别" data-options="男;女"></a-dropdown>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="positionName" data-name="职位名称"></a-text>
    </a-col>
    <a-col>
        <a-user-selector key="directManager" data-name="直线经理"></a-user-selector>
    </a-col>
    <a-col>
        <a-date key="arrivalDate" data-name="到岗日期"></a-date>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="contractDeadline" data-name="合同期限"></a-text>
    </a-col>
    <a-col>
        <a-date key="contractStartDate" data-name="合同开始日期"></a-date>
    </a-col>
    <a-col>
        <a-date key="contractEndDate" data-name="合同结束日期"></a-date>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="probationPeriod" data-name="试用期时长"></a-text>
    </a-col>
    <a-col>
        <a-number key="basicSalary" data-name="基本工资"></a-number>
    </a-col>
    <a-col>
        <a-text key="bonusType" data-name="奖金类型"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-dropdown key="communicationAllowance" data-name="手机/通讯津贴" data-options="自带手机;公司手机"></a-dropdown>
    </a-col>
    <a-col>
        <a-text key="workplace" data-name="工作地点"></a-text>
    </a-col>
    <a-col>
        <a-date key="offerSignBackDate" data-name="offer签回日期"></a-date>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="staffEmail" data-name="新员工邮箱" data-regexp="/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/" data-regexp-text="请输入一个有效邮箱地址"></a-text>
    </a-col>
    <a-col>
        <a-text key="staffMobile" data-name="新员工手机号" data-regexp="/^1[3|4|5|7|8|9][0-9]{9}$/" data-regexp-text="请输入一个有效手机号码"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="mobilizationSite" data-name="调动地点"></a-text>
    </a-col>
    <a-col>
        <a-text key="socialSecurityFundPalace" data-name="社公缴纳地"></a-text>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-group-title key="2001560398474300" data-name="异地调动备忘录"></a-group-title>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-text key="familyCompany" data-name="家属随同情况"></a-text>
    </a-col>
    <a-col>
        <a-number key="housingSubsidyStandard" data-name="住房补贴标准"></a-number>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-number key="liveAllowance" data-name="生活津贴"></a-number>
    </a-col>
    <a-col>
        <a-number key="residentAllowance" data-name="驻外津贴"></a-number>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-number key="settleInAllowance" data-name="安家费"></a-number>
    </a-col>
</a-row>
<a-row>
    <a-col>
        <a-comment key="confirmSign" data-name="员工确认签字"></a-comment>
    </a-col>
</a-row>
</section>

<script id="customScript">
    var enMonArr = {"Jan":"01","Feb":"02","Mar":"03","Apr":"04","May":"05","Jun":"06","Jul":"07","Aug":"08","Spt":"09","Oct":"10","Nov":"11","Dec":"12"};

    (function(form){
        /**
         * 用户自定义JS区域
         */
        /**
         * 事件绑定，form.on
         * @param eventType 事件类型
         * @params function 事件
         * @param  cover    true, false 是否覆盖root的生命周期 默认不覆盖 
         */
        //数据加载后，渲染之前，this为window
        form.on('onLoad',function(data, dataPermission){
            const codes = ['submit']
            this.actions.filter(ac => codes.indexOf(ac.code) > -1)
            .forEach(ac => ac.text = "生成offer");
        },'cover');
        //渲染完成后
        form.on('onRendered',function(data){});
        //内置校验完成后，返回false阻止提交
        form.on('onValidate',function(action,data){
        });
        //操作前（包含自定义按钮）执行，返回false阻止按钮操作
        form.on('onPreAction',function(action,data){
            if(action.code == "submit"){
                localStorage.setItem('productOffer', JSON.stringify(data));
                var localData = JSON.parse(localStorage.getItem('productOffer'));
                // localStorage.setItem('productOffer', JSON.stringify(data));
                var sendData = {
                    offerType: localData.offerType,
                    distributeOfferDate: localData.distributeOfferDate.split("T")[0].split("-")[0]+"-"+localData.distributeOfferDate.split("T")[0].split("-")[1]+"-"+localData.distributeOfferDate.split("T")[0].split("-")[2],
                    realName: localData.realName,
                    sex: localData.sex,
                    positionName: localData.positionName,
                    directManager: localData.directManager,
                    arrivalDate: localData.arrivalDate.split("T")[0].split("-")[0]+"-"+localData.arrivalDate.split("T")[0].split("-")[1]+"-"+localData.arrivalDate.split("T")[0].split("-")[2],
                    contractDeadline: localData.contractDeadline,
                    contractStartDate: localData.contractStartDate.split("T")[0].split("-")[0]+"-"+localData.contractStartDate.split("T")[0].split("-")[1]+"-"+localData.contractStartDate.split("T")[0].split("-")[2],
                    contractEndDate: localData.contractEndDate.split("T")[0].split("-")[0]+"-"+localData.contractEndDate.split("T")[0].split("-")[1]+"-"+localData.contractEndDate.split("T")[0].split("-")[2],
                    probationPeriod: localData.probationPeriod,
                    basicSalary: localData.basicSalary,
                    bonusType: localData.bonusType,
                    communicationAllowance: localData.communicationAllowance,
                    workplace: localData.workplace,
                    offerSignBackDate: localData.offerSignBackDate.split("T")[0].split("-")[0]+"-"+localData.offerSignBackDate.split("T")[0].split("-")[1]+"-"+localData.offerSignBackDate.split("T")[0].split("-")[2],
                    staffEmail: localData.staffEmail,
                    staffMobile: localData.staffMobile,
                    mobilizationSite: localData.mobilizationSite,
                    socialSecurityFundPalace: localData.socialSecurityFundPalace,
                    familyCompany: localData.familyCompany,
                    housingSubsidyStandard: localData.housingSubsidyStandard,
                    liveAllowance: localData.liveAllowance,
                    residentAllowance: localData.residentAllowance,
                    settleInAllowance: localData.settleInAllowance,
                    confirmSign: localData.confirmSign,
                }
                axios.post("http://39.108.48.97:8080/api/faurecia/create_offer",sendData)
                .then((res)=>{
                    if(res.errcode == 0){
                        var iframeParent = window.parent.document.getElementsByTagName("iframe");
                        var iframe = window.document.getElementsByTagName("iframe");
                        iframe[0].src = "productOffer.html"
                        iframeParent[0].style.top = "0px";
                        iframeParent[0].style.width = "100%";
                        iframeParent[0].style.height = "100%";
                        iframeParent[0].style.background = "#FFF";
                        iframeParent[0].style.zIndex = "9999";
                        iframeParent[0].style.border = "none";
                        
                    }
                })
                return false;
            }
        });
        //自定义按钮执行
        form.on('onCustomAction',function(action,data){
        });
        //操作完成后执行
        form.on('onActionDone',function(action,data,httpRes){
            if(action.code == "submit"){
                return false;
            }
        });
    })
</script>
<script src="http://39.108.48.97/admin/config.js" class="templateScript"></script>
<script src="http://39.108.48.97/admin/js/template.js" class="templateScript"></script>
<iframe src="" name="productOffer" frameborder="0" style="width: 100%;height: 100%;"></iframe>

<script>
    // var iframeParent = window.parent.document.getElementsByTagName("iframe");
    var iframeParentHtml = window.document.getElementsByTagName("html");
    var iframeParentBody = window.document.getElementsByTagName("body");
    
    iframeParentHtml[0].style.width = "100%";
    iframeParentHtml[0].style.height = "97%";
    iframeParentBody[0].style.width = "100%";
    iframeParentBody[0].style.height = "100%";

</script>
<!-- <script type="text/javascript" src="ueditor/jquery.min.js"></script> -->
</body>
</html>

